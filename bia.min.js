(function(){function a(a,b){if(window.hasOwnProperty("bia"))window.bia[a]=b;else{let c={};c[a]=b,window.bia=c}}function b(a,b,c){let d=a.attr(b);return void 0===d?c:d}function c(a){let c=b(a,"src",void 0),d=b(a,"target",void 0);if(void 0===c)return m.warn("A script load element was include which did not contain a 'src' tag. This is an invalid load request and will therefore be ignored.",a),{success:!1};if(void 0===d)return m.warn("A script load element was include which did not contain a 'target' tag. This is an invalid load request and will therefore be ignored.",a),{success:!1};let e=b(a,"id",c.substr(c.lastIndexOf("/")+1).replace(".js","")),f=b(a,"dependencies","").split(" ");return 1===f.length&&""===f[0]&&(f=[]),{success:!0,loadRequest:{type:"script",target:d,src:c,id:e,dependencies:f}}}function d(a){let c=b(a,"src",void 0);if(void 0===c)return m.warn("A css load element was include which did not contain a 'src' tag. This is an invalid load request and will therefore be ignored.",a),{success:!1};let d="true"===b(a,"precompiled","false"),e=b(a,"target",void 0);return void 0===e&&!1==d?(m.warn("A css load element was include which did not contain a 'target' tag while not being precompiled. This is an invalid load request and will therefore be ignored.",a),{success:!1}):{success:!0,loadRequest:{type:"style",target:e,src:c,precompiled:d}}}function e(a){let c=b(a,"src",void 0),d=b(a,"target",void 0);if(void 0===c)return m.warn("A region load element was include which did not contain a 'src' tag. This is an invalid load request and will therefore be ignored.",a),{success:!1};if(void 0===d)return m.warn("A region load element was include which did not contain a 'target' tag. This is an invalid load request and will therefore be ignored.",a),{success:!1};let e=b(a,"display","block");return{success:!0,loadRequest:{type:"region",target:d,src:c,display:e}}}function f(a){let b=[],f=a.find("load");return 0===f.length?b:(f.each(function(){let a=$(this),f=a.attr("type");if(void 0===f)return void m.warn("Load element existed in a 'bia-load' element without specifying a type. This will be ignored",a);if("script"===f){let d=c(a);if(d.success){let a=d.loadRequest;a.state=p.READY,a.promise=void 0,b.push(a)}}if("style"===f){let c=d(a);if(c.success){let a=c.loadRequest;a.state=p.READY,a.promise=void 0,b.push(a)}}if("region"===f){let c=e(a);if(c.success){let a=c.loadRequest;a.state=p.READY,a.promise=void 0,b.push(a)}}}),b)}function g(a){for(let b=0;b<q.length;b++)if("script"===q[b].type&&q[b].id===a)return b}function h(a){if(a.state===p.READY){if(a.state=p.LOADING,0===a.dependencies.length)return void(a.promise=new Promise(function(b,c){$.get(a.src,function(c){a.state=p.LOADED;let d="(function($){"+c+"})(bia.buildModifiedjQueryInstance('"+a.target+"'));";d+="\n//# sourceURL="+a.src.substr(a.src.lastIndexOf("/")+1);let e=$("<script>").text(d);$(n.insertion.script).append(e),a.state=p.INJECTED,b()},"text").fail(function(){a.state=p.FAILED,c(!1)})}));let b=[];for(let c,d=0;d<a.dependencies.length;d++)if(c=g(a.dependencies[d]),void 0!==c)a.dependencies[d]={id:a.dependencies[d],index:c},b.push(q[c].promise);else if("load"===n.dependencies.missing)m.warn("Script request has a dependency of a file which has not been detected yet. This is currently unsupported so this script cannot wait for the dependency. This dependency will be ignored and the script loaded as usual. If you want to change this behaviour, update the configuration \"dependencies.missing\" key to \"skip\"."),delete a.dependencies[d];else if("skip"===n.dependencies.missing)return m.warn("Script request has a dependency of a file which has not been detected yet. This is currently unsupported so this script cannot wait for the dependency. This script will be ignored and not loaded. If you want to change this behaviour, update the configuration \"dependencies.missing\" key to \"load\"."),void(a.promise=new Promise(function(b,c){a.state=p.FAILED,c(!1)}));Promise.all(b).then(function(){a.dependencies=[],a.state=p.READY,h(a)}).catch(function(){"load"===n.dependencies.failed?(m.warn("Script request has a dependency of a file which failed to load. This dependency will be ignored and the script loaded as usual. If you want to change this behaviour, update the configuration \"dependencies.failed\" key to \"skip\"."),a.dependencies=[],a.state=p.READY,h(a)):"skip"===n.dependencies.failed&&(m.warn("Script request has a dependency of a file which failed to load. The script will not be loaded. If you want to change this behaviour, update the configuration \"dependencies.failed\" key to \"skip\"."),a.promise=new Promise(function(b,c){a.state=p.FAILED,c(!1)}))})}}function j(a){a.state!==p.READY||(a.state=p.LOADING,a.promise=new Promise(function(b,c){$.get(a.src,function(c){if(c=c,a.state=p.LOADED,!a.precompiled){for(let b=0;-1!==(b=c.indexOf("}",b));){for(let d=b+1;d<c.length;d++)if(!/\s/.test(c.charAt(d))){c=c.substr(0,d)+" #"+a.target+" "+c.substr(d),b+=4+a.target.length;break}b++}c="#"+a.target+" "+c}let d=$("<style>");d.text(c),$(n.insertion.style).append(d),a.state=p.INJECTED,b()},"text").fail(function(){a.state=p.FAILED,c(!1)})}))}function k(a){return a.state===p.READY?(a.state=p.LOADING,new Promise(function(b){a.promise=new Promise(function(c){$.get(a.src,function(d){d=d,a.state=p.LOADED;let e=$(d),f=$("<div>").attr("id",a.target);f.css("display","none"),f.attr("data-bia-display",a.display),f.attr("data-bia-region",!0),f.append(e),$(n.insertion.region).append(f),l.push(a.target);let g=f.find("bia-load");0===g.length?b(void 0):(m.debug("Region has own load block, calling load on it",a),b(f)),a.state=p.INJECTED,c()})})})):Promise.resolve(void 0)}function i(a){return new Promise(function(b){void 0===a&&(o.emit("begin"),a=$("body"));let c=a.find("bia-load");if(r=r.concat(c),0===c.length)return;let d=!1;for(let a=0;a<r.length;a++)if(0!==r[a].find("load[type=\"region\"]").length){d=!0;break}d||b();for(let a,c=0;c<r.length;c++){a=r.pop(),q=q.concat(f(a)),m.debug("Initial list of resources to load",q);for(let a,c=0;c<q.length;c++)a=q[c],a.state===p.READY&&("script"===a.type&&h(a),"style"===a.type&&j(a),"region"===a.type&&k(a).then(function(a){void 0===a?b():i(a).then(b)}));a.remove()}})}let l=[],m={error:function(a,...b){console.error("[bia-loader | ERROR]: "+a);for(let c=0;c<b.length;c++)console.error(b[c])},warn:function(a,...b){console.warn("[bia-loader | WARN]: "+a);for(let c=0;c<b.length;c++)console.warn(b[c])},info:function(a,...b){console.info("[bia-loader | INFO]: "+a);for(let c=0;c<b.length;c++)console.info(b[c])},debug:function(a,...b){console.debug("[bia-loader | DEBUG]: "+a);for(let c=0;c<b.length;c++)console.debug(b[c])},log:function(a,...b){console.log("[bia-loader | LOG]: "+a);for(let c=0;c<b.length;c++)console.log(b[c])}},n={insertion:{script:"body",style:"head",region:"body"},dependencies:{missing:"load",failed:"load"},swap:function(b,c){return o.emit("swap",b),new Promise(function(d,e){if(!l.includes(b))return void e(l);void 0===c&&(c=300);let f=[];$("[data-bia-region]").each(function(){let a=$(this);f.push(new Promise(function(b){a.fadeOut(c,function(){b()})}))}),Promise.all(f).then(function(){let e=$("#"+b);e.css("display",e.attr("data-bia-display")).hide().fadeIn(c,function(){a("activeRegion",b),d()})})})}};a("swap",n.swap),a("configure",function(a,b){if(-1!==a.indexOf(".")){let c=n,d=a.split(".");try{for(let a=0;a<d.length-1;a++)c=c[d[a]];return c[d[d.length-1]]=b,!0}catch(a){return!1}}return n[a]=b,!0});let o={_listeners:{},_waits:{},on:function(a,b){return this._listeners.hasOwnProperty(a)?this._listeners[a].push(b):this._listeners[a]=[b],this},emit:function(a,...b){if(this._listeners.hasOwnProperty(a))for(let c=0;c<this._listeners[a].length;c++)this._listeners[a][c].apply(null,b);if(this._waits.hasOwnProperty(a)){for(let c=0;c<this._waits[a].length;c++)this._waits[a][c].apply(null,b);delete this._waits[a]}return this},once:function(a,b){return this._waits.hasOwnProperty(a)?this._waits[a].push(b):this._waits[a]=[b],this}};a("events",o);let p={READY:0,LOADING:1,FAILED:2,LOADED:3,INJECTED:4},q=[];a("buildModifiedjQueryInstance",function(a){a.startsWith("#")||(a="#"+a);let b=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,c=function(d,f){if("string"==typeof d){let c=!1;"<"===d[0]&&">"===d[d.length-1]&&3<=d.length&&(c=!0),!c&&b.exec(d)&&(c=!0),c||(d=a+" "+d)}return new c.fn.init(d,f)};return c=Object.assign(c,jQuery),c});let r=[];a("load",function(){i(void 0).then(function(){return Promise.all(q.map(function(a){return a.hasOwnProperty("promise")?a.promise:void 0}).filter(function(a){return a!==void 0})).then(function(){o.emit("success")}).catch(function(){let a=!1;for(let b=0;b<q.length&&!a;b++)q[b].state===p.INJECTED&&(a=!0);a?o.emit("partial"):o.emit("fail")}).finally(function(){o.emit("done")})})})})();